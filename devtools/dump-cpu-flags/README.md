# Generating updated CPU flags

File `config\x86\msvc\meson.build` has a table with flags indicating instruction set support for a variety of CPU types.

Script `dump-cpu-flags.py` can be used to generate updated entries for this table.

The CPU names are stored in file `cpu-names.txt`, which is consumed by `dump-cpu-flags.py`. The formatting used in that file is described at the top of the file itself.

The script relies on the information embedded in the g++ compiler. This means that an updated table can automatically be generated by switching to a newer version of the compiler. This avoids the need to manually edit the entries, which is error prone. With the script the table entries can just copied and pasted into `meson.build`. The only thing that might need to be done is adding new CPU names to cpu-names.txt, when new CPUs are released.

**NOTE**: CPUs not known to the compiler will result in errors, which can be ignored (`dump-cpu-flags.py` will ignore these errors and continue). For best results use the latest g++ compiler available.

Below is a sample output, where an error was logged because the compiler did not know about a CPU named ‘raptorlake’.

```sh
$ ./dump-cpu-flags.py
       'x86-64-v2': [],
       'x86-64-v3': ['AVX', 'AVX2'],
       'x86-64-v4': ['AVX', 'AVX2', 'AVX512F', 'AVX512VL', 'AVX512BW', 'AVX512DQ', 'AVX512CD'],
       'alderlake': ['AVX', 'PCLMUL', 'RDRND', 'AVX2', 'RDSEED', 'AES', 'VPCLMULQDQ', 'GFNI'],
cc1plus: error: bad value (‘raptorlake’) for ‘-march=’ switch
cc1plus: note: valid arguments to ‘-march=’ switch are: nocona core2 nehalem corei7 westmere sandybridge...
      'silvermont': ['PCLMUL', 'RDRND'],
             'slm': ['PCLMUL', 'RDRND'],
```